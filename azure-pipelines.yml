trigger:
  - main
pool:
  vmImage: ubuntu-latest
variables:
  serviceNowUrl: $(serviceNowUrl)
  serviceNowUsername: $(serviceNowUser)
  serviceNowPassword: $(serviceNowPassword)
stages:
  - stage: DeployToServiceNow
    jobs:
      - job: DeployUpdateSet
        steps:
          - task: Checkout@1
            inputs:
              repository: Demo_repo
          - script: >
              echo "Downloading update set..."

              wget
              https://raw.githubusercontent.com/vinitamishra15/Demo_repo/sn_instances/dev212832/04b8a32747401210acd2a22f316d43ef/sys_app_04b8a32747401210acd2a22f316d43ef.xml
              -O update-set.xml
            displayName: Download Update Set
          - script: |
              echo "Uploading update set to ServiceNow..."
              curl -u $(serviceNowUsername):$(serviceNowPassword) \
              -X POST "$(serviceNowUrl)/api/now/import/update_set" \
              --header "Accept:application/json" \
              --header "Content-Type:application/xml" \
              --data-binary "@update-set.xml"
            displayName: Upload Update Set to ServiceNow
